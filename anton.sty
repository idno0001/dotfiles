%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% anton.sty %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Class file that includes all my usual LaTeX formatting options. These
% include:
% 1.  fouriernc fonts;
% 2.  microtypography (microtype);
% 3.  \set{.} for {.}, \braket{.} for <.> (braket);
% 4.  \abs and \norm and their starred equivalents (\left \right), kind of
%     copied from the mathtools package;
% 5.  \includesvg[scale]{.} takes svg files, converts them to pdf_tex files if
%     they have changed, and includes them in the same way as \includegraphics;
% 6.  theorem environments (ntheorem);
% 7.  enumerated lists start with Roman and then alpha numbering;
% 8.  cleveref;
% 9.  upright mathematical notation \upd, \upe, \upi, added support for upright
%     greek (so one should use \uppi for the constant pi);
% 10. frequently used symbols such as the set of natural numbers, real numbers,
%     ... all in \mathbf{.} (because \mathbb{.} is for blackboards!);
% 11. optional hyperref, glossaries;
% 12. optional timestamping;
% 13. a custom `notes' environment;
% 14. bm for nicer bold mathematical symbols;
% 15. optional biblatex.
%

% Default font is New Century Schoolbook. The [cm] option drops back to cms.
\newif\if@doFouriernc
\@doFouriernctrue
\DeclareOption{cm}{\@doFourierncfalse}

% [timestamp] adds the compile time to the (fancy) footer of the document.
\newif\if@doTimestamp
\@doTimestampfalse
\DeclareOption{timestamp}{\@doTimestamptrue}

% [citegit] adds the time of the most recent commit to the (fancy) footer of 
% the document.
\newif\if@doCitegit
\@doCitegitfalse
\DeclareOption{citegit}{\@doCitegittrue}

% Add [hyperref] support.
\newif\if@doHyperref
\@doHyperreffalse
\DeclareOption{hyperref}{\@doHyperreftrue}

% Add the glossaries package. [glossariesnomain] is equivalent to the [nomain]
% option; [glossariesnonumberlist] is equivalent to th [nonumberlist] option.
\newif\if@doGlossariesNoMain
\@doGlossariesNoMainfalse
\DeclareOption{glossariesnomain}{\@doGlossariesNoMaintrue}
\newif\if@doGlossariesNoNumList
\@doGlossariesNoNumListfalse
\DeclareOption{glossariesnonumberlist}{\@doGlossariesNoNumListtrue}

% Add [biblatex] support.
\newif\if@doBiblatex
\@doBiblatexfalse
\DeclareOption{biblatex}{\@doBiblatextrue}

\ProcessOptions

\usepackage{amssymb,amsmath}
\usepackage[T1]{fontenc}

\if@doFouriernc
  \usepackage{fouriernc}
\fi
\usepackage{verbatim}
\usepackage{enumitem}
\usepackage[stretch=10]{microtype}
\usepackage{braket}
\usepackage{upgreek}
\usepackage{xparse}
\usepackage{environ}
\usepackage{tikz} % For own notes.
\usepackage{bm}   % For own notes.
\usepackage{graphicx}
\usepackage{color}
\usepackage{suffix}
\usepackage{soul}
\usepackage{colonequals}

\if@doBiblatex
  \usepackage[backend=bibtex8,bibstyle=alphabetic,citestyle=alphabetic-verb,firstinits=true,maxnames=4,doi=false,isbn=false,url=false]{biblatex}
\fi

% Normal timestamping or git timestamping.
\newif\ifstamp
\if@doTimestamp
  \stamptrue
\fi
\if@doCitegit
  \stamptrue
\fi

\if@doHyperref
  \usepackage[colorlinks]{hyperref}
\fi

% Need to load before datetime.
\usepackage[british]{babel}

\ifstamp
  \usepackage{fancyhdr}
  \usepackage[yyyymmdd,hhmmss]{datetime}
  \renewcommand{\dateseparator}{-}
  
  % Get the timezone by using the method described at
  % http://tex.stackexchange.com/questions/8612/write-date-time-and-time-zone/14216#14216
  \def\grabtimezone #1#2#3#4#5#6#7#8#9{\grabtimezoneB}
  \def\grabtimezoneB #1#2#3#4#5#6#7{\grabtimezoneC}
  \def\grabtimezoneC #1#2'#3'{#1#2#3}
  \def\timezone{\expandafter \grabtimezone\pdfcreationdate}

  \pagestyle{fancy}
  \fancyhf{}
  \renewcommand{\headrulewidth}{0pt}
  \lhead{\nouppercase{\textbf{\rightmark}}}
  \rhead{\textbf{\thepage}}
  \if@doTimestamp
    \newcommand{\timestamp}{\today\ \currenttime\ \timezone}
    \rfoot{\timestamp}
  \fi
  \if@doCitegit
    \usepackage{citegit}
    \lfoot{\citegit[\jobname.tex]{\githash}}%
    \ifclean{%
      \newcommand{\timestamp}{\gitdate}%
    }{
      \newcommand{\timestamp}{\today\ \currenttime\ \timezone *}%
    }
    \rfoot{\timestamp}%
  \fi
  % \datewatermark prints an arXiv-like timestamp on the current page.
  \usepackage{blindtext,tikz}
  \usetikzlibrary{calc}
  \newcommand{\datewatermark}{%
    \tikz[overlay,remember picture]%
    {%
      \node at ($(current page.west)+(1.5,0)$) [rotate=90] {\Huge\textcolor{gray}{%
      %\citegit[\jobname.tex]{\githash}
      \timestamp}};%
    }%
  }
  \fi

\usepackage[thmmarks,amsmath]{ntheorem}

\if@doGlossariesNoMain
	\usepackage[nomain]{glossaries}
\fi
\if@doGlossariesNoNumList
	\usepackage[nonumberlist]{glossaries}
\fi

\usepackage{cleveref}

% Inkscape graphics. Compiles new diagram if svg file changes.
% Use \includesvg to insert images (exclude file extension), with optional
% argument that scales the image relative to the page width.
\newcommand{\executeiffilenewer}[3]{%
	\ifnum\pdfstrcmp{\pdffilemoddate{#1}}%
	{\pdffilemoddate{#2}}>0%
	{\immediate\write18{#3}}\fi%
}
\newcommand{\includesvg}[2][1]{%
	\executeiffilenewer{fig/#2.svg}{fig/#2.pdf}%
	{inkscape -z -D --file=fig/#2.svg %
		--export-pdf=fig/#2.pdf --export-latex}%
		\def\svgwidth{#1\columnwidth}
		\input{fig/#2.pdf_tex}%
}
\graphicspath{{fig/}}

% Theorem environments.
\theorembodyfont{}
\theoremseparator{.}
\theoremstyle{nonumberbreak}
\newtheorem{remarks}{Remarks}
\theoremstyle{plain}
\newtheorem{lemma}{Lemma}
\newtheorem{proposition}{Proposition}
\newtheorem{theorem}{Theorem}
\newtheorem{corollary}{Corollary}
\theoremstyle{nonumberplain}
\newtheorem{definition}{Definition}
\newtheorem{example}{Example}
\newtheorem{fact}{Fact}
\newtheorem{notation}{Notation}
\newtheorem{remark}{Remark}
\theoremheaderfont{\it}\theorembodyfont{\upshape}
\theoremsymbol{\ensuremath{\blacksquare}}
\newtheorem{claim}{Claim}
\theoremheaderfont{\sc}\theorembodyfont{\upshape}
\theoremsymbol{\ensuremath{\square}}
\newtheorem{proof}{Proof}

% Redefine lists to use roman numerals.
\setlist[enumerate,1]{label=(\roman*), ref=(\roman*)}
\setlist[enumerate,2]{label=(\alph*), ref=(\theenumi.\alph*)}

% Indent paragraphs in enumerated lists.
\setenumerate{listparindent=\parindent}

% Key words.
\newcommand{\key}[1]{\emph{#1}}

% Upright mathematical constants. For consistency, one should use \uppi for
% the constant number pi. The starred version of \upd inserts a space before
% the upright d and so is designed to be used in integrals.
\if@doFouriernc
  \DeclareSymbolFont{symbolfont}{T1}{fnc}{m}{n}
\else
  \DeclareSymbolFont{symbolfont}{T1}{cmr}{m}{n}
\fi 
\DeclareMathSymbol{\upd}\mathalpha{symbolfont}{`\d}
\WithSuffix\newcommand\upd*{\ensuremath{\ \upd}}
\DeclareMathSymbol{\upe}\mathalpha{symbolfont}{`\e}
\DeclareMathSymbol{\upi}\mathalpha{symbolfont}{`\i}

% Frequently used symbols.
\newcommand{\1}{\ensuremath{\mathbf{1}}}
\newcommand{\A}{\mathcal{A}}
\newcommand{\B}{\mathcal{B}}
\newcommand{\complexes}{\mathbf{C}}
\newcommand{\C}{\mathcal{C}}
\newcommand{\D}{\mathcal{D}}
\newcommand{\E}{\mathcal{E}}
\newcommand{\Exp}{\mathbf{E}}
\newcommand{\F}{\mathcal{F}}
\renewcommand{\L}{\mathcal{L}}
\newcommand{\naturals}{\mathbf{N}}
\newcommand{\N}{\mathcal{N}}
\newcommand{\rationals}{\mathbf{Q}}
\newcommand{\reals}{\mathbf{R}}
\newcommand{\integers}{\mathbf{Z}}
\newcommand{\join}{\vee}
\newcommand{\bigjoin}{\bigvee}
\DeclareMathOperator{\card}{card}
\newcommand{\cl}[1]{\overline{#1}} % `closure'
\DeclareMathOperator{\id}{id}
\newcommand{\symdiff}{\bigtriangleup}
\newcommand{\Lip}{\mathrm{Lip}}
\DeclareMathOperator{\var}{var} % variation of a function
\newcommand{\ft}[1]{\ensuremath{\hat{#1}}} % Fourier transform

% Avoids inconsistent use of notation.
\renewcommand{\subset}{\subseteq}
\renewcommand{\supset}{\supseteq}
\renewcommand{\tilde}[1]{\widetilde{#1}}

\renewcommand{\vec}[1]{\mathbf{#1}}

% \relmiddle is like \middle, but gives the same spacing as \mid. I don't
% use this anymore because \Set{.} works well.
\newcommand{\relmiddle}[1]{\mathrel{}\middle#1\mathrel{}}
\newcommand{\midmid}{\relmiddle|}
\newcommand{\seedot}{\mathrel{}\cdot\mathrel{}}
\newcommand{\midcolon}{\,:\,}

% Triple verts for |||.||| norms. \left \right doesn't work.
\makeatletter
\def\@tvsp{\mathchoice{{}\mkern-4.5mu}{{}\mkern-4.5mu}{{}\mkern-2.5mu}{}}
\def\ltrivert{\left\lvert\@tvsp\left\lvert\@tvsp\left\lvert}
\def\rtrivert{\right\rvert\@tvsp\right\rvert\@tvsp\right\rvert}
\makeatother
\newcommand{\trinorm}[1]{\ltrivert #1 \rtrivert}

% Various paired delimiters using xparse.
% abs
\NewDocumentCommand{\abs}{s O{} m}{%
  \IfBooleanTF{#1} % starred
  	{{\left\lvert#3\right\rvert}}
    {{#2\lvert#3#2\rvert}}
}
%norm
\NewDocumentCommand{\norm}{s O{} m}{%
  \IfBooleanTF{#1}
  	{{\left\lVert#3\right\rVert}}
    {{#2\lVert#3#2\rVert}}
}
% floor
\NewDocumentCommand{\floor}{s O{} m}{%
  \IfBooleanTF{#1}
  	{{\left\lfloor#3\right\rfloor}}
    {{#2\lfloor#3#2\rfloor}}
}
% ceil
\NewDocumentCommand{\ceil}{s O{} m}{%
  \IfBooleanTF{#1}
	  {{\left\lceil#3\right\rceil}}
    {{#2\lceil#3#2\rceil}}
}

% Labels for relation symbols.
\newcommand{\refrel}[2]{\ensuremath{\stackrel{\text{#1}}}{#2}}

% Environment for own notes.
\NewEnviron{notes}{
\par\noindent
\begin{tikzpicture}
\node[rectangle,minimum width=1.00\textwidth] (m) 
{\begin{minipage}{0.90\textwidth}\textbf{Notes.} \BODY\end{minipage}};
\draw[dashed] (m.south west) rectangle (m.north east);
\end{tikzpicture}
}

% Change horrible default heading style for KOMA document classes.
\makeatletter
\@ifundefined{KOMAClassName}%
  {}%
  {\setkomafont{disposition}{\normalfont\bfseries}}%
\makeatother

% \ot for \leftarrow.
\newcommand{\ot}{\ensuremath{\leftarrow}}

